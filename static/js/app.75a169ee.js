(function(e){function t(t){for(var s,n,i=t[0],l=t[1],c=t[2],m=0,f=[];m<i.length;m++)n=i[m],Object.prototype.hasOwnProperty.call(o,n)&&o[n]&&f.push(o[n][0]),o[n]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);u&&u(t);while(f.length)f.shift()();return a.push.apply(a,c||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],s=!0,i=1;i<r.length;i++){var l=r[i];0!==o[l]&&(s=!1)}s&&(a.splice(t--,1),e=n(n.s=r[0]))}return e}var s={},o={app:0},a=[];function n(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=s,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/static/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var u=l;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var s=r("85ec"),o=r.n(s);o.a},4805:function(e,t,r){"use strict";var s=r("8ce0"),o=r.n(s);o.a},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var s=r("2b0e"),o=r("5f5b"),a=(r("f9e3"),r("2dd8"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("router-view")],1)}),n=[],i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"hello"},[r("h1",[e._v(e._s(e.msg))]),e._m(0),r("h3",[e._v("Installed CLI Plugins")]),e._m(1),r("h3",[e._v("Essential Links")]),e._m(2),r("h3",[e._v("Ecosystem")]),e._m(3)])},l=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("p",[e._v(" For a guide and recipes on how to configure / customize this project,"),r("br"),e._v(" check out the "),r("a",{attrs:{href:"https://cli.vuejs.org",target:"_blank",rel:"noopener"}},[e._v("vue-cli documentation")]),e._v(". ")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-babel",target:"_blank",rel:"noopener"}},[e._v("babel")])]),r("li",[r("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-eslint",target:"_blank",rel:"noopener"}},[e._v("eslint")])])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",[r("li",[r("a",{attrs:{href:"https://vuejs.org",target:"_blank",rel:"noopener"}},[e._v("Core Docs")])]),r("li",[r("a",{attrs:{href:"https://forum.vuejs.org",target:"_blank",rel:"noopener"}},[e._v("Forum")])]),r("li",[r("a",{attrs:{href:"https://chat.vuejs.org",target:"_blank",rel:"noopener"}},[e._v("Community Chat")])]),r("li",[r("a",{attrs:{href:"https://twitter.com/vuejs",target:"_blank",rel:"noopener"}},[e._v("Twitter")])]),r("li",[r("a",{attrs:{href:"https://news.vuejs.org",target:"_blank",rel:"noopener"}},[e._v("News")])])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",[r("li",[r("a",{attrs:{href:"https://router.vuejs.org",target:"_blank",rel:"noopener"}},[e._v("vue-router")])]),r("li",[r("a",{attrs:{href:"https://vuex.vuejs.org",target:"_blank",rel:"noopener"}},[e._v("vuex")])]),r("li",[r("a",{attrs:{href:"https://github.com/vuejs/vue-devtools#vue-devtools",target:"_blank",rel:"noopener"}},[e._v("vue-devtools")])]),r("li",[r("a",{attrs:{href:"https://vue-loader.vuejs.org",target:"_blank",rel:"noopener"}},[e._v("vue-loader")])]),r("li",[r("a",{attrs:{href:"https://github.com/vuejs/awesome-vue",target:"_blank",rel:"noopener"}},[e._v("awesome-vue")])])])}],c={name:"HelloWorld",props:{msg:String}},u=c,m=(r("4805"),r("2877")),f=Object(m["a"])(u,i,l,!1,null,"b9167eee",null),p=f.exports,g={name:"App",components:{HelloWorld:p}},d=g,v=(r("034f"),Object(m["a"])(d,a,n,!1,null,null,null)),h=v.exports,b=(r("45fc"),r("8c4f")),_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"home-page"}},[r("GlobalHeader"),r("GlobalMessage"),r("main",{staticClass:"container"},[r("p",{staticClass:"h5 mb-4"},[e._v("ホーム")]),r("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitSave(t)}}},[r("div",{staticClass:"row form-group"},[r("label",{staticClass:"col-sm-3 col-form-label"},[e._v("タイトル")]),r("div",{staticClass:"col-sm-8"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.form.book.title,expression:"form.book.title"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.form.book.title},on:{input:function(t){t.target.composing||e.$set(e.form.book,"title",t.target.value)}}})])]),r("div",{staticClass:"row form-group"},[r("label",{staticClass:"col-sm-3 col-form-label"},[e._v("価格")]),r("div",{staticClass:"col-sm-8"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.form.book.price,expression:"form.book.price"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.form.book.price},on:{input:function(t){t.target.composing||e.$set(e.form.book,"price",t.target.value)}}})])]),r("div",{staticClass:"row text-center mt-5"},[r("div",{staticClass:"col-sm-12"},[r("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v(e._s(e.isCreated?"更新":"登録"))])],1)])])],1)],1)},w=[],k=(r("99af"),r("d3b7"),r("07ac"),r("bc3a")),C=r.n(k),y=r("2f62");s["default"].use(y["a"]);var j={strict:!1,namespaced:!0,state:{username:"",isLoggedIn:!1},getters:{username:function(e){return e.username},isLoggedIn:function(e){return e.isLoggedIn}},mutations:{set:function(e,t){e.username=t.user.username,e.isLoggedIn=!0},clear:function(e){e.username="",e.isLoggedIn=!1}},actions:{login:function(e,t){return M.post("/auth/jwt/create/",{username:t.username,password:t.password}).then((function(t){return localStorage.setItem("access",t.data.access),e.dispatch("reload").then((function(e){return e}))}))},logout:function(e){localStorage.removeItem("access"),e.commit("clear")},reload:function(e){return M.get("/auth/users/me/").then((function(t){var r=t.data;return e.commit("set",{user:r}),r}))}}},x={strict:!1,namespaced:!0,state:{error:"",warnings:[],info:""},getters:{error:function(e){return e.error},warnings:function(e){return e.warnings},info:function(e){return e.info}},mutations:{set:function(e,t){t.error&&(e.error=t.error),t.warnings&&(e.warnings=t.warnings),t.info&&(e.info=t.info)},clear:function(e){e.error="",e.warnings=[],e.info=""}},actions:{setErrorMessage:function(e,t){e.commit("clear"),e.commit("set",{error:t.message})},setWarningMessages:function(e,t){e.commit("clear"),e.commit("set",{warnings:t.messages})},setInfoMessage:function(e,t){e.commit("clear"),e.commit("set",{info:t.message})},clearMessages:function(e){e.commit("clear")}}},$=new y["a"].Store({modules:{auth:j,message:x}}),I=$,L=C.a.create({baseURL:"/api/v1/",timeout:5e3,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});L.interceptors.request.use((function(e){I.dispatch("message/clearMessages");var t=localStorage.getItem("access");return t?(e.headers.Authorization="JWT "+t,e):e}),(function(e){return Promise.reject(e)})),L.interceptors.response.use((function(e){return e}),(function(e){console.log("error.response=",e.response);var t,r=e.response?e.response.status:500;if(400===r){var s=[].concat.apply([],Object.values(e.response.data));I.dispatch("message/setWarningMessages",{messages:s})}else if(401===r){var o=localStorage.getItem("access");t=null!=o?"ログイン有効期限切れ":"認証エラー",I.dispatch("auth/logout"),I.dispatch("message/setErrorMessage",{message:t})}else I.dispatch("message/setErrorMessage",{message:t});return Promise.reject(e)}));var M=L,O=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"header"}},[r("b-navbar",{attrs:{type:"dark",variant:"dark"}},[r("a",{staticClass:"navbar-brand",attrs:{href:"/"}},[e._v("DRF Sample")]),e.$route.meta.requiresAuth?r("b-navbar-nav",{staticClass:"ml-auto"},[e.isLoggedIn?r("b-nav-item-dropdown",{attrs:{right:""}},[r("template",{slot:"button-content"},[e._v(e._s(e.username))]),r("b-dropdown-item",{attrs:{href:"#"},on:{click:e.clickLogout}},[e._v("ログアウト")])],2):r("b-nav-item",{attrs:{href:"#"},on:{click:e.clickLogin}},[e._v("ログイン")])],1):e._e()],1)],1)},S=[],E=(r("ac1f"),r("5319"),{computed:{username:function(){return this.$store.getters["auth/username"]},isLoggedIn:function(){return this.$store.getters["auth/isLoggedIn"]}},methods:{clickLogout:function(){this.$store.dispatch("auth/logout"),this.$store.dispatch("message/setInfoMessage",{message:"ログアウトしました。"}),this.$router.replace("/login")},clickLogin:function(){this.$store.dispatch("message/clearMessages"),this.$router.replace("/login")}}}),P=E,q=Object(m["a"])(P,O,S,!1,null,null,null),G=q.exports,H=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"messages"}},[r("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.error,expression:"message.error"}],staticClass:"mb-0",attrs:{variant:"danger",show:""}},[e._v(" "+e._s(e.message.error)+" ")]),r("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.warnings.length>0,expression:"message.warnings.length > 0"}],staticClass:"mb-0",attrs:{variant:"warning",show:""}},e._l(e.message.warnings,(function(t,s){return r("p",{key:s,staticClass:"mb-0"},[e._v(e._s(t))])})),0),r("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.info,expression:"message.info"}],staticClass:"mb-0",attrs:{variant:"info",show:""}},[e._v(" "+e._s(e.message.info)+" ")])],1)},T=[],N={computed:{message:function(){return this.$store.state.message}}},W=N,A=Object(m["a"])(W,H,T,!1,null,null,null),D=A.exports,F={components:{GlobalHeader:G,GlobalMessage:D},data:function(){return{form:{book:{title:"",price:0}}}},computed:{isCreated:function(){return void 0!==this.form.book.id}},methods:{submitSave:function(){var e=this;M({method:this.isCreated?"put":"post",url:this.isCreated?"/books/"+this.form.book.id+"/":"/books/",data:{id:this.form.book.id,title:this.form.book.title,price:this.form.book.price}}).then((function(t){var r=e.isCreated?"更新しました。":"登録しました。";e.$store.dispatch("message/setInfoMessage",{message:r}),e.form.book=t.data}))}}},R=F,J=Object(m["a"])(R,_,w,!1,null,null,null),U=J.exports,z=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"login-page"}},[r("GlobalHeader"),r("GlobalMessage"),r("main",{staticClass:"container"},[r("p",{staticClass:"h5 mb-4"},[e._v("ログイン")]),r("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitLogin(t)}}},[r("div",{staticClass:"row form-group"},[r("label",{staticClass:"col-sm-3 col-form-label"},[e._v("ユーザー名")]),r("div",{staticClass:"col-sm-8"},[r("b-form-input",{attrs:{type:"text",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)]),r("div",{staticClass:"row form-group"},[r("label",{staticClass:"col-sm-3 col-form-label"},[e._v("パスワード")]),r("div",{staticClass:"col-sm-8"},[r("b-form-input",{attrs:{type:"password",required:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)]),r("div",{staticClass:"row text-center mt-5"},[r("div",{staticClass:"col-sm-12"},[r("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("ログイン")])],1)])])],1)],1)},X=[],B={components:{GlobalHeader:G,GlobalMessage:D},data:function(){return{form:{username:"",password:""}}},methods:{submitLogin:function(){var e=this;this.$store.dispatch("auth/login",{username:this.form.username,password:this.form.password}).then((function(){console.log("Login succeeded."),e.$store.dispatch("message/setInfoMessage",{message:"ログインしました。"});var t=e.$route.query.next||"/";e.$router.replace(t)}))}}},K=B,Q=Object(m["a"])(K,z,X,!1,null,null,null),V=Q.exports,Y=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-table",{attrs:{striped:"",hover:"",items:e.items}})],1)},Z=[],ee={},te=ee,re=Object(m["a"])(te,Y,Z,!1,null,null,null),se=re.exports;s["default"].use(b["a"]);var oe=new b["a"]({mode:"history",routes:[{path:"/",component:U,meta:{requiresAuth:!0}},{path:"/login",component:V},{path:"*",redirect:"/"},{path:"/booklist",component:se}]});function ae(e,t,r){console.log("Force user to login page."),r({path:"/login",query:{next:e.fullPath}})}oe.beforeEach((function(e,t,r){var s=I.getters["auth/isLoggedIn"],o=localStorage.getItem("access");console.log("to.path=",e.path),console.log("isLoggedIn=",s),e.matched.some((function(e){return e.meta.requiresAuth}))?s?(console.log("User is already logged in. So, free to next."),r()):null!=o?(console.log("User is not logged in. Trying to reload again."),I.dispatch("auth/reload").then((function(){console.log("Succeeded to reload. So, free to next."),r()})).catch((function(){ae(e,t,r)}))):ae(e,t,r):(console.log("Go to public page."),r())}));var ne=oe;s["default"].use(o["a"]),s["default"].config.productionTip=!0,new s["default"]({router:ne,store:I,render:function(e){return e(h)}}).$mount("#app")},"85ec":function(e,t,r){},"8ce0":function(e,t,r){}});
//# sourceMappingURL=app.75a169ee.js.map